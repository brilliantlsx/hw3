#**数字图像处理**
第三次作业
###**学号**：2160504053
###**班级**：自动化62
###**姓名**：张坤
###**提交日期**：3/17
###**实验环境**：MATLAB2018b
###**实验简介**：图像直方图、直方图均衡、直方图匹配、局部直方图增强、直方图分割
 ----
**1.把附件图像的直方图画出；**
**实现思路**：使用matlab的imread函数读取图片，此处需同时读取出调色板，再通过ind2gray函数将读出图像转变为灰度图，最后使用imhist函数即可绘制出图像的直方图
**代码实现**：
```matlab
clc;clear all;
%读取图像和调色板数据
[s{1},map{1}]=imread('citywall1.bmp');
[s{2},map{2}]=imread('citywall2.bmp');
[s{3},map{3}]=imread('elain1.bmp');
[s{4},map{4}]=imread('elain2.bmp');
[s{5},map{5}]=imread('elain3.bmp');
[s{6},map{6}]=imread('lena1.bmp');
[s{7},map{7}]=imread('lena2.bmp');
[s{8},map{8}]=imread('lena4.bmp');
[s{9},map{9}]=imread('woman1.bmp');
[s{10},map{10}]=imread('woman2.bmp');
[y{1},map2{1}]=imread('citywall.bmp');
[y{2},map2{2}]=imread('elain.bmp');
[y{3},map2{3}]=imread('lena.bmp');
[y{4},map2{4}]=imread('woman.bmp');
%转换为灰度图
for i=1:10
    g{i}=ind2gray(s{i},map{i});
end
for i=1:4
    h{i}=ind2gray(y{i},map2{i});
end
%在3*3方格中绘制直方图
subplot(4,4,1)
imhist(h{1});title('citywall1');
subplot(4,4,2)
imhist(g{1});title('citywall1');
subplot(4,4,3)
imhist(g{2});title('citywall2');
subplot(4,4,6)
imhist(g{3});title('elain1');
subplot(4,4,5)
imhist(h{2});title('elain');
subplot(4,4,7)
imhist(g{4});title('elain2');
subplot(4,4,8)
imhist(g{5});title('elain3');
subplot(4,4,9)
imhist(h{3});title('lena');
subplot(4,4,10)
imhist(g{6});title('lena1');
subplot(4,4,11)
imhist(g{7});title('lena2');
subplot(4,4,12)
imhist(g{8});title('lena4');
subplot(4,4,13)
imhist(h{4});title('woman');
subplot(4,4,14)
imhist(g{9});title('woman1');
subplot(4,4,15)
imhist(g{10});title('woman2');

```
**运行结果**：
![直方图][1]*直方图*
 ---
**2.把所有图像进行直方图均衡；输出均衡后的图像和源图像进行比对；分析改善内容；**
**实现思路**：图像读取和预处理部分与题一一致，直方图均衡可使用histeq函数实现，为突出显示结果细节，将图片两两一组显示.
**代码实现**：
```matlab
clc;clear all;
%读取图像和调色板数据
[s{1},map{1}]=imread('citywall1.bmp');
[s{2},map{2}]=imread('citywall2.bmp');
[s{3},map{3}]=imread('elain1.bmp');
[s{4},map{4}]=imread('elain2.bmp');
[s{5},map{5}]=imread('elain3.bmp');
[s{6},map{6}]=imread('lena1.bmp');
[s{7},map{7}]=imread('lena2.bmp');
[s{8},map{8}]=imread('lena4.bmp');
[s{9},map{9}]=imread('woman1.bmp');
[s{10},map{10}]=imread('woman2.bmp');
[y{1},map2{1}]=imread('citywall.bmp');
[y{2},map2{2}]=imread('elain.bmp');
[y{3},map2{3}]=imread('lena.bmp');
[y{4},map2{4}]=imread('woman.bmp');
%转换为灰度图
for i=1:10
    g{i}=ind2gray(s{i},map{i});
end
for i=1:4
    h{i}=ind2gray(y{i},map2{i});
end
%对图片分别进行直方图均衡  
for i=1:10
    c{i}=histeq(g{i},256);
end
%分别显示
figure(1)
subplot(1,2,1)
imshow(g{1});title('citywall1');
subplot(1,2,2)
imshow(c{1});title('citywall1直方图均衡');
figure(2)
subplot(1,2,1)
imshow(g{2});title('citywall2');
subplot(1,2,2)
imshow(c{2});title('citywall2直方图均衡');
figure(3)
subplot(1,2,1)
imshow(g{3});title('elain1');
subplot(1,2,2)
imshow(c{3});title('elain1直方图均衡');
figure(4)
subplot(1,2,1)
imshow(g{4});title('elain2');
subplot(1,2,2)
imshow(c{4});title('elain2直方图均衡');
figure(5)
subplot(1,2,1)
imshow(g{5});title('elain3');
subplot(1,2,2)
imshow(c{5});title('elain3直方图均衡');
figure(6)
subplot(1,2,1)
imshow(g{6});title('lena1');
subplot(1,2,2)
imshow(c{6});title('lena1直方图均衡');
figure(7)
subplot(1,2,1)
imshow(g{7});title('lena2');
subplot(1,2,2)
imshow(c{7});title('lena2直方图均衡');
figure(8)
subplot(1,2,1)
imshow(g{8});title('lena4');
subplot(1,2,2)
imshow(c{8});title('lena4直方图均衡');
figure(9)
subplot(1,2,1)
imshow(g{9});title('woman1');
subplot(1,2,2)
imshow(c{9});title('woman1直方图均衡');
figure(10)
subplot(1,2,1)
imshow(g{10});title('woman2');
subplot(1,2,2)
imshow(c{10});title('woman2直方图均衡');
```
**运行结果**:
![结果2][2]
**分析**：原图亮度较高，直方图均衡后显示出了更多细节，但图像过渡显得不够平滑
![结果3][3]
**分析**：原图亮度较低，直方图均衡后显示出了更多细节，但图像过渡显得不够平滑
![结果4][4]
**分析**：原图亮度过高，且灰度基本分布在高亮度区域，直方图均衡后显得对比度过大
![结果5][5]
**分析**：原图亮度较高，直方图均衡后亮度偏低
![结果6][6]
**分析**：原图亮度过低，且灰度基本分布在低亮度区域，直方图均衡后显示出较多细节
![结果7][7]
**分析**：原图灰度基本密集地集中于高亮度地区，直方图均衡后呈现出类似二值化的效果
![结果8][8]
**分析**：原图亮度较高，直方图均衡后显示出很好的效果，与源文件基本一致
![结果9][9]
**分析**：原图亮度较低，直方图均衡后图片显示更多细节，但亮度偏高
![woman1][10]
**分析**：原图灰度基本密集地集中于高亮度地区，直方图均衡后呈现出类似二值化的效果
![woman2][11]
**分析**：原图亮度偏低，直方图均衡后效果较好
 ---
**3.进一步把图像按照对源图像直方图的观察，各自自行指定不同源图像的直方图，进行直方图匹配，进行图像增强；**
**实现思路**：直方图匹配可使用matlab中的histeq函数实现，需要获取规定图像的直方图（用imhist函数读取），其中规定图像的直方图从提供的源文件中读取，再结合一二题中对原图像的提取，即可获得与指定直方图类似的图片

**代码实现**：
```matlab
clc;clear all;
%读取图像和调色板数据
[s{1},map{1}]=imread('citywall1.bmp');
[s{2},map{2}]=imread('citywall2.bmp');
[s{3},map{3}]=imread('elain1.bmp');
[s{4},map{4}]=imread('elain2.bmp');
[s{5},map{5}]=imread('elain3.bmp');
[s{6},map{6}]=imread('lena1.bmp');
[s{7},map{7}]=imread('lena2.bmp');
[s{8},map{8}]=imread('lena4.bmp');
[s{9},map{9}]=imread('woman1.bmp');
[s{10},map{10}]=imread('woman2.bmp');
[y{1},map2{1}]=imread('citywall.bmp');
[y{2},map2{2}]=imread('elain.bmp');
[y{3},map2{3}]=imread('lena.bmp');
[y{4},map2{4}]=imread('woman.bmp');
%转换为灰度图
for i=1:10
    g{i}=ind2gray(s{i},map{i});
end
for i=1:4
    g2{i}=ind2gray(y{i},map2{i});
    h{i}=imhist(g2{i});
end
r{1}=histeq(g{1},h{1});
r{2}=histeq(g{2},h{1});
r{3}=histeq(g{3},h{2});
r{4}=histeq(g{4},h{2});
r{5}=histeq(g{5},h{2});
r{6}=histeq(g{6},h{3});
r{7}=histeq(g{7},h{3});
r{8}=histeq(g{8},h{3});
r{9}=histeq(g{9},h{4});
r{10}=histeq(g{10},h{4});

figure(1)
subplot(2,3,1)
imshow(g{1});title('citywall1');
subplot(2,3,2)
imshow(g2{1});title('citywall');
subplot(2,3,3)
imshow(r{1});title('匹配后citywall1');
subplot(2,3,4)
imhist(g{1});title('对应直方图');
subplot(2,3,5)
imhist(g2{1});title('对应直方图');
subplot(2,3,6)
imhist(r{1});title('对应直方图');

figure(2)
subplot(2,3,1)
imshow(g{2});title('citywall2');
subplot(2,3,2)
imshow(g2{1});title('citywall');
subplot(2,3,3)
imshow(r{2});title('匹配后citywall2');
subplot(2,3,4)
imhist(g{2});title('对应直方图');
subplot(2,3,5)
imhist(g2{1});title('对应直方图');
subplot(2,3,6)
imhist(r{2});title('对应直方图');

figure(3)
subplot(2,3,1)
imshow(g{3});title('elain1');
subplot(2,3,2)
imshow(g2{2});title('elain');
subplot(2,3,3)
imshow(r{3});title('匹配后elain1');
subplot(2,3,4)
imhist(g{3});title('对应直方图');
subplot(2,3,5)
imhist(g2{2});title('对应直方图');
subplot(2,3,6)
imhist(r{3});title('对应直方图');

figure(4)
subplot(2,3,1)
imshow(g{4});title('elain2');
subplot(2,3,2)
imshow(g2{2});title('elain');
subplot(2,3,3)
imshow(r{4});title('匹配后elain2');
subplot(2,3,4)
imhist(g{4});title('对应直方图');
subplot(2,3,5)
imhist(g2{2});title('对应直方图');
subplot(2,3,6)
imhist(r{4});title('对应直方图');

figure(5)
subplot(2,3,1)
imshow(g{5});title('elain3');
subplot(2,3,2)
imshow(g2{2});title('elain');
subplot(2,3,3)
imshow(r{5});title('匹配后elain3');
subplot(2,3,4)
imhist(g{5});title('对应直方图');
subplot(2,3,5)
imhist(g2{2});title('对应直方图');
subplot(2,3,6)
imhist(r{5});title('对应直方图');

figure(6)
subplot(2,3,1)
imshow(g{6});title('lena1');
subplot(2,3,2)
imshow(g2{3});title('lena');
subplot(2,3,3)
imshow(r{6});title('匹配后lena1');
subplot(2,3,4)
imhist(g{6});title('对应直方图');
subplot(2,3,5)
imhist(g2{3});title('对应直方图');
subplot(2,3,6)
imhist(r{6});title('对应直方图');

figure(7)
subplot(2,3,1)
imshow(g{7});title('lena2');
subplot(2,3,2)
imshow(g2{3});title('lena');
subplot(2,3,3)
imshow(r{7});title('匹配后lena2');
subplot(2,3,4)
imhist(g{7});title('对应直方图');
subplot(2,3,5)
imhist(g2{3});title('对应直方图');
subplot(2,3,6)
imhist(r{7});title('对应直方图');

figure(8)
subplot(2,3,1)
imshow(g{8});title('lena4');
subplot(2,3,2)
imshow(g2{3});title('lena');
subplot(2,3,3)
imshow(r{8});title('匹配后lena4');
subplot(2,3,4)
imhist(g{8});title('对应直方图');
subplot(2,3,5)
imhist(g2{3});title('对应直方图');
subplot(2,3,6)
imhist(r{8});title('对应直方图');

figure(9)
subplot(2,3,1)
imshow(g{9});title('woman1');
subplot(2,3,2)
imshow(g2{4});title('woman');
subplot(2,3,3)
imshow(r{9});title('匹配后woman1');
subplot(2,3,4)
imhist(g{9});title('对应直方图');
subplot(2,3,5)
imhist(g2{4});title('对应直方图');
subplot(2,3,6)
imhist(r{9});title('对应直方图');

figure(10)
subplot(2,3,1)
imshow(g{10});title('woman2');
subplot(2,3,2)
imshow(g2{4});title('woman');
subplot(2,3,3)
imshow(r{10});title('匹配后woman2');
subplot(2,3,4)
imhist(g{10});title('对应直方图');
subplot(2,3,5)
imhist(g2{4});title('对应直方图');
subplot(2,3,6)
imhist(r{10});title('对应直方图');
```

![匹配1][12]*citywall1*
![匹配2][13]*citywall2*
![匹配3][14]*elain1*
![匹配4][15]*elain2*
![匹配5][16]*elain3*
![lena1][17]*lena1*
![匹配7][18]*lena2*
![匹配8][19]*lena4*
![woman1][20]*woman1*
![woman][21]*woman2*

**分析**：对直方图灰度范围较小的图像来说，因为直方图内包含的信息较少，进行直方图匹配较为困难，结果也不是十分理想，例如lena1和woman1中，直方图匹配后图像二值化。但对直方图灰度范围稍大的图像，直方图匹配能获得很好的效果，如citywall1和lena2


 ---
**4.对elain和lena图像进行7*7的局部直方图增强；**
**实现思路**：matlab提供的adapthisteq函数，可逐个匹配图像中的较小区域，本题中使用7*7的小块来进行局部增强

**代码实现**：
```matlab
s{1}=imread('elain.bmp');
s{2}=imread('woman.bmp');
g1=adapthisteq(s{1},'NumTiles',[7,7]);
g2=adapthisteq(s{2},'NumTiles',[7,7]);
subplot(2,2,1)
imshow(s{1});title('elain')
subplot(2,2,2)
imshow(g1);title('局部增强elain')
subplot(2,2,3)
imshow(s{2});title('woman')
subplot(2,2,4)
imshow(g2);title('局部增强woman')
```
![局部增强][22]
**分析**：局部直方图增强可显示出更多的细节，但woman图像头发部分有些失真


  [1]: https://s2.ax1x.com/2019/03/17/AZh4MV.png
  [2]: https://s2.ax1x.com/2019/03/13/Ak3Tns.png
  [3]: https://s2.ax1x.com/2019/03/13/Ak3Rtf.png
  [4]: https://s2.ax1x.com/2019/03/13/Ak3c7t.png
  [5]: https://s2.ax1x.com/2019/03/13/Ak32AP.png
  [6]: https://s2.ax1x.com/2019/03/13/Ak35cQ.png
  [7]: https://s2.ax1x.com/2019/03/13/Ak3h9S.png
  [8]: https://s2.ax1x.com/2019/03/13/Ak37Bn.png
  [9]: https://s2.ax1x.com/2019/03/13/Ak3H7q.png
  [10]: https://s2.ax1x.com/2019/03/17/AZ4iid.png
  [11]: https://s2.ax1x.com/2019/03/17/AZ4CIH.png
  [12]: https://s2.ax1x.com/2019/03/13/Akd43t.png
  [13]: https://s2.ax1x.com/2019/03/13/Akd6BD.png
  [14]: https://s2.ax1x.com/2019/03/13/AkdcHe.png
  [15]: https://s2.ax1x.com/2019/03/13/Akdh9I.png
  [16]: https://s2.ax1x.com/2019/03/13/AkdrjK.png
  [17]: https://s2.ax1x.com/2019/03/15/AEgNL9.png
  [18]: https://s2.ax1x.com/2019/03/13/Akd2AH.png
  [19]: https://s2.ax1x.com/2019/03/13/AkdRNd.png
  [20]: https://s2.ax1x.com/2019/03/15/AEgwIx.png
  [21]: https://s2.ax1x.com/2019/03/15/AEgdd1.png
  [22]: https://s2.ax1x.com/2019/03/15/AEgaZR.png